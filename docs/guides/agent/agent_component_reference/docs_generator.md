---
sidebar_position: 35
slug: /docs_generator
---

# 文档生成器组件

一个从 markdown 样式内容生成可下载的 PDF、DOCX 或 TXT 文档的组件,完全支持 Unicode。

---

**文档生成器**组件使您能够直接在智能体工作流中创建专业文档。它接受 markdown 格式的文本并将其转换为可下载的文件,使其成为生成报告、摘要或任何结构化文档输出的理想选择。

## 主要功能

- **多种输出格式**: PDF、DOCX 和 TXT
- **完整的 Unicode 支持**: CJK(中文、日文、韩文)、阿拉伯语、希伯来语和其他非拉丁语系的自动字体切换
- **丰富的格式**: 标题、列表、表格、代码块等
- **可定制的样式**: 字体、边距、页面大小和方向
- **文档附加功能**: Logo、水印、页码和时间戳
- **直接下载**: 为聊天界面生成下载按钮

## 前提条件

- 要转换为文档的内容(通常来自 **智能体**或其他文本生成组件)。

## 示例

您可以将 **智能体**组件与 **文档生成器**配对,根据用户查询创建动态文档。**智能体**生成内容,**文档生成器**将其转换为可下载文件。将输出连接到 **消息**组件以在聊天中显示下载按钮。

典型的工作流如下:

```
Begin → Agent → Docs Generator → Message
```

在 **消息**组件中,引用 **文档生成器**的 `download` 输出变量以在聊天界面中显示下载按钮。

## 配置

### 内容

文档中包含的主要文本内容。支持 Markdown 格式:

- **粗体**: `**text**` 或 `__text__`
- **斜体**: `*text*` 或 `_text_`
- **行内代码**: `` `code` ``
- **标题**: `# Heading 1`, `## Heading 2`, `### Heading 3`
- **项目列表**: `- item` 或 `* item`
- **编号列表**: `1. item`
- **表格**: `| Column 1 | Column 2 |`
- **水平线**: `---`
- **代码块**: ` ``` code ``` `

:::tip 注意
点击 **(x)** 或输入 `/` 插入来自上游组件的变量。
:::

### 标题

可选。显示在生成文件顶部的文档标题。

### 副标题

可选。显示在标题下方的副标题。

### 输出格式

生成文档的文件格式:

- **PDF**(默认): 具有完整样式支持的便携式文档格式。
- **DOCX**: Microsoft Word 格式。
- **TXT**: 纯文本格式。

### Logo 图片

可选。显示在文档顶部的 logo 图片。您可以:

- 使用文件选择器上传图片文件
- 粘贴图片路径、URL 或 base64 编码的数据

### Logo 位置

Logo 的水平位置:

- **left**(默认)
- **center**
- **right**

### Logo 尺寸

- **Logo 宽度**: 英寸为单位的宽度(默认: `2.0`)
- **Logo 高度**: 英寸为单位的高度(默认: `1.0`)

### 字体系列

整个文档使用的字体:

- **Helvetica**(默认)
- **Times-Roman**
- **Courier**
- **Helvetica-Bold**
- **Times-Bold**

### 字体大小

基本字体大小(以磅为单位)。默认为 `12`。

### 标题字体大小

文档标题的字体大小。默认为 `24`。

### 页面大小

文档的纸张大小:

- **A4**(默认)
- **Letter**

### 方向

页面方向:

- **Portrait**(默认)
- **Landscape**

### 边距

页面边距(以英寸为单位):

- **上边距**: 默认为 `1.0`
- **下边距**: 默认为 `1.0`
- **左边距**: 默认为 `1.0`
- **右边距**: 默认为 `1.0`

### 文件名

可选。生成文档的自定义文件名。如果留空,将自动生成带时间戳的文件名。

### 输出目录

保存生成文档的服务器目录。默认为 `/tmp/pdf_outputs`。

### 添加页码

启用后,页码将添加到每页的页脚。默认为 `true`。

### 添加时间戳

启用后,生成时间戳将添加到文档页脚。默认为 `true`。

### 水印文本

可选。显示为跨每页对角线水印的文本。用于将文档标记为"草稿"、"机密"等。

## 输出

**文档生成器**组件提供以下输出变量:

| 变量名称 | 类型      | 描述                                                  |
|---------------|-----------|--------------------------------------------------------------|
| `file_path`   | `string`  | 生成文档保存的服务器路径。       |
| `pdf_base64`  | `string`  | 以 base64 格式编码的文档内容。               |
| `download`    | `string`  | 包含聊天界面下载信息的 JSON。 |
| `success`     | `boolean` | 指示文档是否成功生成。   |

### 显示下载按钮

要在聊天中显示下载按钮,请在 **文档生成器**之后添加 **消息**组件并引用 `download` 变量:

1. 将 **文档生成器**输出连接到 **消息**组件。
2. 在 **消息**组件的内容字段中,输入 `/` 并选择 `{Docs Generator_0@download}`。
3. 当智能体运行时,聊天中将出现下载按钮,允许用户下载生成的文档。

下载按钮自动处理:
- 文件类型检测(PDF、DOCX、TXT)
- 浏览器下载的正确 MIME 类型
- 直接文件传递的 base64 解码

## Unicode 和多语言支持

**文档生成器**包含针对国际内容的智能字体处理:

### 工作原理

1. **内容分析**: 组件扫描文本中的非拉丁字符。
2. **自动字体切换**: 当检测到 CJK 或其他复杂文字时,系统自动切换到兼容的 CID 字体(中文使用 STSong-Light,日文使用 HeiseiMin-W3,韩文使用 HYSMyeongJo-Medium)。
3. **拉丁内容**: 对于仅包含拉丁字符(包括扩展拉丁、西里尔和希腊语)的文档,使用用户选择的字体系列。

### 支持的文字

| 文字                       | Unicode 范围 | 使用的字体          |
|------------------------------|---------------|--------------------|
| 中文 (CJK)                | U+4E00–U+9FFF | STSong-Light       |
| 日文 (平假名/片假名) | U+3040–U+30FF | HeiseiMin-W3       |
| 韩文 (Hangul)              | U+AC00–U+D7AF | HYSMyeongJo-Medium |
| 阿拉伯语                       | U+0600–U+06FF | CID 字体回退  |
| 希伯来语                       | U+0590–U+05FF | CID 字体回退  |
| 天城文 (印地语)           | U+0900–U+097F | CID 字体回退  |
| 泰语                         | U+0E00–U+0E7F | CID 字体回退  |

### 字体安装

要在自托管部署中实现完整的多语言支持,请确保安装了 Unicode 字体:

**Linux (Debian/Ubuntu):**
```bash
apt-get install fonts-freefont-ttf fonts-noto-cjk
```

**Docker:** 官方 RAGFlow Docker 镜像包含这些字体。对于自定义镜像,将字体包添加到您的 Dockerfile:
```dockerfile
RUN apt-get update && apt-get install -y fonts-freefont-ttf fonts-noto-cjk
```

:::tip 注意
CID 字体(STSong-Light、HeiseiMin-W3 等)内置在 ReportLab 中,不需要额外安装。当检测到 CJK 内容时会自动使用。
:::

## 故障排除

### 字符显示为方框或问号

这表示缺少字体支持。确保:
1. 内容包含支持的 Unicode 字符。
2. 对于自托管部署,在服务器上安装了 Unicode 字体。
3. 在支持嵌入字体的 PDF 阅读器中查看文档。

### 下载按钮未显示

确保:
1. **消息**组件连接在 **文档生成器**之后。
2. 使用 `/` 正确引用了 `download` 变量(复制时显示为 `{Docs Generator_0@download}`)。
3. 文档生成成功完成(检查 `success` 输出)。

### 大表格未正确渲染

对于包含多列或大单元格内容的表格:
- 组件自动将宽表格转换为定义列表格式以提高可读性。
- 考虑将大表格拆分为多个较小的表格。
- 对宽表格使用横向方向。
