---
sidebar_position: 5
slug: /ingestion_pipeline_quickstart
sidebar_custom_props: {
  categoryIcon: LucideRoute
}
---

# 摄入流水线快速入门

RAGFlow 的摄入流水线是一个可定制的、分步工作流,用于准备文档以进行高质量的 AI 检索和回答。您可以将其视为构建块:连接不同的处理"组件"以创建适合您的特定文档和需求的流水线。

---

RAGFlow 是一个具有强大文档处理能力的开源 RAG 平台。其内置模块 DeepDoc 使用智能解析来分割文档以进行准确检索。为了处理多样化的现实世界需求—如不同的文件来源、复杂的布局和更丰富的语义—RAGFlow 现在引入了*摄入流水线*。

摄入流水线让您可以自定义文档处理的每一步:

- 针对不同场景应用不同的解析和分割规则
- 添加预处理,如摘要或关键字提取
- 连接到云驱动器和在线数据源
- 使用高级布局感知模型处理表格和混合内容

这种灵活的流水线适应您的数据,提高 RAG 中的答案质量。

## 1. 了解核心流水线组件

- **解析器** 组件:读取和理解您的文件(PDF、图片、电子邮件等),提取文本和结构。
- **转换器** 组件:通过使用 AI 添加摘要、关键字或问题来增强文本,以提高搜索质量。
- **分块器** 组件:将长文本分割成最佳大小的段("块"),以便更好地进行 AI 检索。
- **索引器** 组件:最后一步。将处理后的数据发送到文档引擎(支持混合全文和向量搜索)。

## 2. 创建摄入流水线

1. 转到 **智能体** 页面。
2. 点击 **创建智能体** 并从空白画布或预构建模板开始(推荐给初学者)。
3. 在画布上,从右侧面板拖放并连接组件以设计您的流程(例如,解析器 → 分块器 → 转换器 → 索引器)。

*现在让我们构建一个典型的摄入流水线!*

## 3. 配置解析器组件

**解析器** 组件将您的文件转换为结构化文本,同时保留布局、表格、标题和其他格式。它支持的文件 8 大类、23+ 种格式,包括 PDF、图片、音频、视频、电子邮件、电子表格 (Excel)、Word、PPT、HTML 和 Markdown。以下是一些关键配置:

- 对于 PDF 文件,选择以下选项之一:
  - **DeepDoc**(默认): RAGFlow 的内置模型。最适合扫描文档或具有表格的复杂布局。
  - **MinerU**: 在数学公式和复杂布局等复杂元素方面处于行业领先地位。
  - **Naive**: 简单的文本提取。用于没有复杂元素的干净、基于文本的 PDF。
- 对于图片文件:默认使用 OCR。还可以配置视觉语言模型 (VLM) 以进行高级视觉理解。
- 对于电子邮件文件:选择要解析的特定字段(例如,"主题"、"正文")以进行精确提取。
- 对于电子表格:以 HTML 格式输出,保留行/列结构。
- 对于 Word/PPT:以 JSON 格式输出,保留文档层次结构(标题、段落、幻灯片)。
- 对于文本和标记 (HTML/MD):自动删除格式标签,输出干净的文本。

![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/parser1.png)
![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/parser2.png)

## 4. 配置分块器组件

分块器组件智能地分割文本。它的目标是防止 AI 上下文窗口溢出并提高混合搜索中的语义准确性。有两种核心方法(可以按顺序使用):

- 按 Token(默认):
  - 块大小:默认为 512 个 token。在检索质量和模型兼容性之间取得平衡。
  - 重叠:设置 **重叠百分比** 以将一个块的末尾复制到下一个块的开头。提高语义连续性。
  - 分隔符:默认使用 `\n`(换行符)首先在自然段落边界处分割,避免句子中间切割。
- 按标题(分层):
  - 最适合结构化文档,如手册、论文、法律合同。
  - 系统按章节/部分结构分割文档。每个块代表一个完整的结构单元。

:::caution 重要
在当前设计中,如果同时使用 Token 和标题方法,请先连接 **Token 分块器** 组件,然后连接 **标题分块器** 组件。将 **标题分块器** 直接连接到 **解析器** 可能会导致电子邮件、图片、电子表格和文本文件的格式错误。
:::

## 5. 配置转换器组件

**转换器** 组件旨在弥合"语义差距"。一般来说,它使用 AI 模型添加语义元数据,使您的内容在检索期间更容易被发现。它有四种生成类型:

- 摘要:创建简洁的概述。
- 关键字:提取关键术语。
- 问题:生成每个文本块可以回答的问题。
- 元数据:自定义元数据提取。

如果您有多个 **转换器**,请确保为每个功能分离 **转换器** 组件(例如,一个用于摘要,另一个用于关键字)。

以下是一些关键配置:

- 模型模式:(选择一个)
  - 即兴:更有创意,适合问题生成。
  - 精确:严格忠实于文本,适合摘要/关键字提取。
  - 平衡:大多数场景的中间地带。
- 提示工程:每种生成类型的系统提示都是开放和可定制的。
- 连接:**转换器** 可以在 **解析器** 之后连接(处理整个文档)或在 **分块器** 之后连接(处理每个块)。
- 变量引用:节点不会自动获取内容。在用户提示中,通过输入 `/` 并选择特定输出(例如,`/{解析器.输出}` 或 `/{分块器.输出}`)来手动引用上游变量。
- 串联连接:链接 **转换器** 时,如果正确引用变量,第二个 **转换器** 组件将处理第一个的输出(例如,从摘要生成关键字)。

![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/transformer1.png)
![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/transformer2.png)
![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/transformer3.png)

## 6. 配置索引器组件

**索引器** 组件为最佳检索进行索引。这是最后一步,将处理后的数据写入搜索引擎(例如 Infinity、Elasticsearch、OpenSearch)。以下是一些关键配置:

- 搜索方法:
  - 全文:关键字搜索,用于精确匹配(代码、名称)。
  - 嵌入:使用向量相似性的语义搜索。
  - 混合(推荐):两种方法结合以获得最佳召回率。
- 检索策略:
  - 处理后的文本(默认):索引分块的文本。
  - 问题:索引生成的问题。通常产生比文本到文本更高的相似性匹配。
  - 增强上下文:索引摘要而不是原始文本。适合广泛的主题匹配。
- 文件名权重:滑块,将文档文件名包含为检索中的语义信息。
- 嵌入模型:自动使用创建数据集时设置的模型。

![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/indexer.png)

:::caution 重要
要同时搜索多个数据集,所有选定的数据集必须使用相同的嵌入模型。
:::

## 7. 测试运行

在流水线画布上点击 **运行** 上传示例文件并查看分步结果。

## 8. 将流水线连接到数据集

1. 创建或编辑数据集时,找到 **摄入流水线** 部分。
2. 点击 **选择流水线** 并选择您保存的流水线。

![](https://raw.githubusercontent.com/infiniflow/ragflow-docs/main/images/dataset_ingestion_settings.png)

*现在,上传到此数据集的任何文件都将由您的自定义流水线处理。*

