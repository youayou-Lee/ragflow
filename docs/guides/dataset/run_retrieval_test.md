---
sidebar_position: 10
slug: /run_retrieval_test
sidebar_custom_props: {
  categoryIcon: LucideTextSearch
}
---
# 运行检索测试

对您的数据集进行检索测试，以检查是否可以检索到预期的分块。

---

文件上传并解析后，建议您在继续配置聊天助手之前运行检索测试。运行检索测试*绝非*多余或不必要的步骤！就像调校精密仪器一样，RAGFlow 需要仔细调整以提供最佳的问答性能。您的数据集设置、聊天助手配置以及指定的各种模型都会显著影响最终结果。运行检索测试可以验证是否可以检索到预期的分块，使您能够快速识别需要改进的领域或确定需要解决的任何问题。例如，在调试问答系统时，如果您知道可以检索到正确的分块，则可以将精力集中在其他地方。例如，在问题 [#5627](https://github.com/infiniflow/ragflow/issues/5627) 中，发现问题是由大语言模型的局限性造成的。

在检索测试期间，使用混合搜索检索从您指定的分块方法创建的分块。此搜索将加权关键词相似度与加权向量余弦相似度或加权重排序分数相结合，具体取决于您的设置：

- 如果未选择重排序模型，加权关键词相似度将与加权向量余弦相似度结合。
- 如果选择了重排序模型，加权关键词相似度将与加权向量重排序分数结合。

相比之下，从[知识图谱构建](./construct_knowledge_graph.md)创建的分块仅使用向量余弦相似度进行检索。

## 先决条件

- 在运行检索测试之前，您的文件已上传并成功解析。
- 必须成功构建知识图谱才能启用 **Use knowledge graph**。

## 配置

### 相似度阈值

这设置了检索分块的门槛：相似度低于阈值的分块将被过滤掉。默认情况下，阈值设置为 0.2。这意味着仅检索混合相似度分数为 20 或更高的分块。

### 向量相似度权重

这将设置向量相似度在组合相似度评分中的权重，无论与向量余弦相似度还是重排序分数一起使用。默认情况下，它设置为 0.3，使另一个组件的权重为 0.7（1 - 0.3）。

### 重排序模型

- 如果留空，RAGFlow 将使用加权关键词相似度和加权向量余弦相似度的组合。
- 如果选择了重排序模型，加权关键词相似度将与加权向量重排序分数结合。

:::danger 重要
使用重排序模型将显著增加接收响应的时间。
:::

### 使用知识图谱

在知识图谱中，实体描述、关系描述或社区报告各自作为独立的分块存在。此开关指示是否将这些分块添加到检索中。

该开关默认禁用。启用后，RAGFlow 在检索测试期间执行以下操作：

1. 使用大语言模型从查询中提取实体和实体类型。
2. 使用提取的实体类型，根据其 PageRank 值从图中检索前 N 个实体。
3. 使用提取的查询实体的嵌入从图中查找相似实体及其 N 跳关系。
4. 使用查询嵌入从图中检索相似关系。
5. 通过将每个实体的 PageRank 值与其与查询的相似度分数相乘来排序这些检索到的实体和关系，返回前 n 个作为最终检索。
6. 检索涉及最终检索中最多实体的社区的报告。
   *检索到的实体描述、关系描述和前 1 个社区报告将发送到大语言模型进行内容生成。*

:::danger 重要
在检索测试中使用知识图谱将显著增加接收响应的时间。
:::

### 跨语言搜索

要执行[跨语言搜索](../../references/glossary.mdx#cross-language-search)，请从下拉菜单中选择一个或多个目标语言。系统的默认聊天模型随后会将您在 Test text 字段中输入的查询翻译为所选的目标语言。这种翻译确保了跨语言的准确语义匹配，允许您无论语言差异都能检索到相关结果。

:::tip 注意
- 选择目标语言时，请确保这些语言存在于数据集中以保证有效搜索。
- 如果未选择目标语言，系统将仅以您的查询语言进行搜索，这可能会遗漏其他语言中的相关信息。
:::

### 测试文本

此字段是您输入测试查询的地方。

## 操作步骤

1. 导航到数据集的 **Retrieval testing** 页面，在 **Test text** 中输入查询，然后点击 **Testing** 运行测试。
2. 如果结果不令人满意，请调整配置部分中列出的选项并重新运行测试。

   *以下是不使用知识图谱进行的检索测试的屏幕截图。它演示了结合加权关键词相似度和加权向量余弦相似度的混合搜索。总体混合相似度分数为 28.56，计算方式为 25.17（术语相似度分数）x 0.7 + 36.49（向量相似度分数）x 0.3：*
   ![Image](https://github.com/user-attachments/assets/541554d4-3f3e-44e1-954b-0ae77d7372c6)

   *以下是使用知识图谱进行的检索测试的屏幕截图。它显示仅对知识图谱生成的分块使用向量相似度：*
   ![Image](https://github.com/user-attachments/assets/30a03091-0f7b-4058-901a-f4dc5ca5aa6b)

:::caution 警告
如果您调整了默认设置（例如关键词相似度权重或相似度阈值）以实现最佳结果，请注意这些更改不会自动保存。您必须将它们应用到聊天助手设置或 **Retrieval** 智能体组件设置。
:::

## 常见问题

### 启用使用知识图谱开关时是否使用大语言模型？

是的，您的大语言模型将参与分析您的查询并从知识图中提取相关实体和关系。这也解释了为什么将消耗额外的令牌和时间。
